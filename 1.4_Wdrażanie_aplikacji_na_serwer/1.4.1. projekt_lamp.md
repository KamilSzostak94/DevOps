# Omówienie stosu technologicznego
```bash
LAMP czyli:
Linux
Apache
MySQL
PHP
```
## Instalacja zależności

```bash
Instalacja npm:
npm install

Jeśli chcemy odpalić plik npm wrzucamy polecenie
npm run <nazwa>
```

## Instalacja Apache

### Ubuntu
```bash 
$ sudo apt-get install apache2 # instalacja
$ sudo systemctl status apache2 # status
$ sudo systemctl stop apache2 # zatrzymanie usługi
$ sudo systemctl start apache2 # uruchomienie usługi
$ sudo systemctl restart apache # reset apache
```
### CentOS
```bash
$ sudo yum install httpd # instalacja
$ sudo systemctl status httpd # status
$ sudo systemctl stop httpd # zatrzymanie usługi
$ sudo systemctl start httpd # uruchomienie usługi
$ sudo systemctl restart httpd # reset apache
$ sudo systemctl enable httpd # uruchomienie po resecie
```

## Instalacja PHP

### Instalacja Ubuntu

```bash
$ sudo apt-get install php libapache2-mod-php
```

Instaluje nam to interpreter PHP oraz moduł PHP dla Apache

### Instalacja CentOS


```bash
$ sudo yum install php
```
Repozytorium CentOS ma odpowednik libeapache2-mod-php

## Jak uruchomić plik PHP

### Ubuntu

```bash
/var/www/html # root WWW
/etc/apache2/mods-enabled/dir.conf # konfiguracja katalogów apache
```

### CentOS

```bash
/var/www/html # root WWW
/etc/httpd/conf/ # kofiguracja katalogów apache gdzie httpd.conf to główny plik
```
Można zmienić uprawnienia do katalogu www by nie wpisywać hasło roota ciągle

```bash
$ sudo chown -R $USER:$USER www
```

## Instalacja MySQL

 Apache
  |
 PHP
  |
 MySQL

### Ubuntu

```bash
$ sudo apt-get install mysql-server
```

### CentOS
```bash
$ sudo yum install mysql-server
$ sudo dnf install mysql-server
$ sudo mysql_secure_installation # bezpieczna instalacja

```
### Uruchomienie usługi

```bash
$ sudo systemctl start mysqld
$ sudo systemctl enable mysqld
$ sudo systemctl status mysqld
```

### Podstawy pracy z MySQL
```bash
$ mysql -u root -p #logowanie do bazy
$ exit #wylogowanie
```

## Instalacja phpmyadmin

### Ubuntu
```bash
$ sudo apt install phpmyadmin php-mbstring php-gettext -y

Instalacja phpmyadmin z modułami. W Centosie są już z pakietem
```
### CentOS
```bash
$ sudo yum install phpmyadmin
```

Moduły które zainstalowaliśmy dla Ubuntu uruchamiamy za pomocą polecenia

```bash
$ sudo phpenmod mcrypt
$ sudo phpenmod mbstring
```
Pamiętamy o restarcie apache2!

#### http://domena/phpmyadmin - panel

Jeżeli panel nam się nie włączył należy sprawdzić główny plik konfiguracyjny

```bash
$ sudo vim /etc/httpd/conf.d/phpMyAdmin.conf
```

Jeżeli w zapisie będziemy mieli

```bash
<Directory /usr/share/phpMyAdmin/> AddDefaultCharset UTF-8 
Require local 
</Directory> 
<Directory /usr/share/phpMyAdmin/setup/> Require local 
</Directory>
```
Zmieniamy na

```bash
Require all granted
```

A następnie resetujemy httpd

### Dodajemy plik htaccess

```bash
$ sudo vim /etc/httpd/conf.d/phpMyAdmin.conf
Ustawiamy AllowOverrideAll # zezwala na nadpisywanie pliku
```
Lokalizacja .htaccess /usr/share/phpMyAdmin/.htaccess

### Derektywy w .htaccess
```bash
AuthType Basic
AuthName "Brak dostepu"
AuthUserFile /etc/phpMyAdmin/.htpasswd
Require valid-user

- AuthType Basic # Określa rodzaj uwierzytelnienia gdzie Basic oznacza, że login i hasło są przesyłane zakodowane
- AuthName # Komunikat, który wyświetli się w przeglądarce 
- AuthUserFile # Wskazuje miejsce gdzie będą zapisywani użytkownicy oraz hasła
- Require valid-user #Dostęp mają użytkownicy, którzy są w pliku 
```

### htpasswd – tworzenie pliku z hasłami dla Apache
```bash
sudo htpasswd -c /etc/phpMyAdmin/.htpasswd <nazwa użytkownika>
```
 - `htpasswd` – polecenie do zarządzania plikiem haseł dla Apache.
- `-c` – utworzenie nowego pliku (uwaga: nadpisze stary plik). Przy dodawaniu kolejnego użytkownika nie wpisujemy już -c
- `/etc/phpMyAdmin/.htpasswd` - ścieżka do pliku z loginami i hasłami.

Powstanie nam plik .htpasswd z użytkownikiem i zaszyfrowanym hasłem, którego Apache używa do uwierzytelnienia.

### Wdrażanie certyfikatu SSL
- https://letsencrypt.org/
- darmowy certyfikat na 90 dni
- zautomatyzowany proces certyfikacji
- łatwa integracja z apache albo nginx
- potrzebny jest klient (certbot)

```bash
https://github.com/letsencrypt/letsencrypt # repo klient
https://github.com/certbot/certbot.git #certbot
/opt/letsencrypt # katalog docelowy
$ ./letsencrypt-auto --httpd -d domena # uruchamia proces certyfikacji
```
## Ważne!

`letsencrypt-auto` już nie istnieje - ten skrypt został wycofany. Teraz używa się pakietu Certbot.

W opcji -d nie podajesz http:// ani IP
– Let’s Encrypt nie wystawia certyfikatów na adresy IP (musi być domena).
Czyli -d = nazwa domeny, np.:

```bash
-d moja-domena.pl -d www.moja-domena.pl
```

1. Zainstaluj certbota dla Apache:
```bash
sudo yum install certbot python3-certbot-apache
```
2. Uruchom certbot z domeną (nie IP!):
```bash
sudo certbot --apache -d moja-domena.pl -d www.moja-domena.pl
```

Certbot sam:
- wygeneruje certyfikat
- podmieni konfigurację Apache na HTTPS
- ustawi automatyczne odnawianie